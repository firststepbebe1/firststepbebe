<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>First Step Bebe Â· Magazin</title>
<meta name="description" content="HÄƒinuÈ›e de bebeluÈ™i â€” body-uri, costumaÈ™e, compleuri. TVA inclus. ComandÄƒ rapid pe WhatsApp sau Email.">
<link rel="icon" href="assets/logos.png" type="image/png" />
<style>
:root{--bg:#fffaf6;--card:#ffffff;--primary:#6c63ff;--text:#463d3d;--muted:#8c7f7f;--radius:18px;--shadow:0 10px 24px rgba(0,0,0,.08)}
*{box-sizing:border-box} body{margin:0;font-family:Arial, sans-serif;background:var(--bg);color:var(--text)}
.topbar{position:sticky;top:0;z-index:5;display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#fff;box-shadow:var(--shadow)}
.brand{display:flex;align-items:center;gap:10px}
.brand img{height:44px;border-radius:10px}
.brand strong{font-size:18px}
.pill{border:none;background:var(--primary);color:#fff;padding:10px 14px;border-radius:999px;font-weight:600;text-decoration:none}
.link{color:var(--text);font-weight:600;text-decoration:none;margin-right:8px}
.hero{text-align:center;padding:24px 16px}
.badge{display:inline-block;font-size:12px;color:#555;background:#f3eefc;border-radius:999px;padding:4px 10px;margin-right:8px}
.title{margin:8px 0;font-weight:bold}
.meta{font-size:12px;color:var(--muted)}
.price{font-weight:700;margin:8px 0 12px}
.btn{background:var(--primary);color:#fff;border:none;border-radius:12px;padding:10px 12px;font-weight:600;cursor:pointer}
.btn.added{animation:btnPulse .6s ease}
@keyframes btnPulse{0%{transform:scale(1)}40%{transform:scale(1.06)}100%{transform:scale(1)}}
.grid{display:grid;gap:16px;padding:8px 16px 40px;grid-template-columns:repeat(1,minmax(0,1fr))}
@media(min-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:1080px){.grid{grid-template-columns:repeat(3,1fr)}}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
.card img{width:100%;height:240px;object-fit:cover;background:#f4f0ec}
.content{padding:12px}

/* SIDEBAR LAYOUT */
.layout{display:grid; grid-template-columns:260px 1fr; gap:16px; padding:0 16px 32px}
@media(max-width:900px){ .layout{grid-template-columns:1fr} .sidebar{display:none} .sidebar.open{display:block} }
.sidebar{background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:14px}
.sidebar h3{margin:0 0 8px;font-size:16px}
.catlist{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
.catbtn{width:100%;text-align:left;border:none;background:#f3eefc;color:#463d3d;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600}
.catbtn.active{background:var(--primary);color:#fff}
.toggleCats{display:none;margin:0 16px 10px;border:none;background:#ece7ff;color:#6c63ff;padding:10px 12px;border-radius:12px;font-weight:700}
@media(max-width:900px){ .toggleCats{display:inline-flex;align-items:center;gap:8px}}

/* Mobile fine-tuning */
@media(max-width:480px){
  .topbar{padding:10px 12px}
  .brand img{height:40px}
  .brand strong{font-size:16px}
  .hero{padding:18px 12px}
  .hero h2{font-size:20px; margin:0 0 6px}
  .grid{gap:14px; padding:8px 12px 28px}
  .card img{height:200px}
  .content{padding:10px}
  .title{font-size:15px}
  .meta{font-size:11px}
  .price{margin:8px 0 10px}
  .btn{padding:12px 14px; border-radius:14px}
  .toggleCats{margin:0 12px 10px}
  .cart{margin:0 12px 28px; padding:14px}
  .cart-item{padding:10px 0}
  .iconbtn{width:32px; height:32px}
}

/* CART */
.cart{background:#fff;margin:0 16px 40px;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow)}
.cart.hidden{display:none}
.cart-item{display:flex;gap:12px;align-items:center;padding:12px 0;border-bottom:1px solid #eee}
.cart-item img{width:64px;height:64px;object-fit:cover;border-radius:10px}
.grow{flex:1}
.iconbtn{border:none;background:#f1efff;color:var(--primary);width:28px;height:28px;border-radius:8px;cursor:pointer;font-weight:800}
.line{display:flex;justify-content:space-between;margin:6px 0}
.line.total{font-size:18px;font-weight:800}
.note{color:var(--muted);font-size:12px}
.actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.btn.whats{background:#25D366;color:#0b3b22;text-decoration:none}

/* Checkout fields */
.checkout-fields{display:grid;gap:10px;margin-top:8px}
.checkout-fields label{font-size:12px;color:var(--muted)}
.checkout-fields input{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e1ff;font-family:inherit}
.status{margin-top:6px;font-size:13px}

/* Lightbox */
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:50}
.lightbox.open{display:flex}
.lightbox img{max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4);background:#fff;touch-action:none}
.lightbox .lbBtn{position:absolute;top:50%;transform:translateY(-50%);border:none;background:rgba(255,255,255,.2);color:#fff;width:44px;height:44px;border-radius:999px;cursor:pointer;font-size:22px;font-weight:700;display:flex;align-items:center;justify-content:center}
.lightbox .lbPrev{left:18px}
.lightbox .lbNext{right:18px}

/* Cart modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:saturate(140%) blur(4px);align-items:flex-start;justify-content:center;z-index:55;overflow:auto;padding:24px 12px;opacity:0;visibility:hidden;transition:opacity .28s ease}
.modal.open{opacity:1;visibility:visible}
.modal .dialog{width:100%;max-width:760px;transform:translateX(36px);opacity:0;transition:transform .36s cubic-bezier(.22,.61,.36,1), opacity .36s ease}
.modal.open .dialog{transform:translateX(0);opacity:1}
.modal .close{position:sticky;top:0;display:flex;justify-content:flex-end;margin-bottom:8px}
.modal .closebtn{border:none;background:#fff;color:#333;padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow)}

@media (prefers-reduced-motion: reduce){
  .modal{transition:none}
  .modal .dialog{transition:none}
}
</style>
</head>
<body>
<script>try{document.write('<script src="config.js"><\/script>')}catch(e){}</script>
<header class="topbar">
  <div class="brand">
    <!-- PoÈ›i Ã®nlocui src cu logo-ul tÄƒu permanent: https://i.ibb.co/6JFRF5Qq/file-000000005e2461f4a48ca916ed01c75c-2.png -->
    <img src="assets/logos.png" alt="First Step Bebe" loading="lazy" onerror="this.onerror=null; this.src='assets/Logo.png';"/>
    <strong>First Step Bebe</strong>
  </div>
  <nav>
    <a href="#" id="navProducts" class="link">Produse</a>
    <a href="#" id="navCart" class="pill">CoÈ™ <span id="cartCount">0</span></a>
  </nav>
</header>

<section class="hero">
  <h2>HÄƒinuÈ›e moi pentru primii paÈ™i</h2>
  <p>Pastel Â· Confort Â· PreÈ›uri cu TVA inclus Â· 10 bucÄƒÈ›i pe set</p>
</section>

<button class="toggleCats" id="toggleCats">â˜° Categorii</button>
<div class="layout">
  <aside class="sidebar" id="sidebar">
    <h3>ðŸ§¸ Categorii</h3>
    <ul class="catlist">
      <li><button class="catbtn active" data-cat="toate">Toate</button></li>
      <li><button class="catbtn" data-cat="body">Body-uri</button></li>
      <li><button class="catbtn" data-cat="costumas">CostumaÈ™e</button></li>
      <li><button class="catbtn" data-cat="compleu">Compleuri</button></li>
      <li><button class="catbtn" data-cat="pijama">Pijamale</button></li>
      <li><button class="catbtn" data-cat="accesorii">Accesorii</button></li>
    </ul>
  </aside>

  <section id="products" class="grid"></section>
</div>

<div id="cartModal" class="modal" aria-modal="true" role="dialog" aria-label="CoÈ™ de cumpÄƒrÄƒturi">
  <div class="dialog">
    <div class="close"><button id="cartClose" class="closebtn" aria-label="ÃŽnchide coÈ™ul">ÃŽnchide</button></div>
    <section id="cartPanel" class="cart">
      <h3>CoÈ™ de cumpÄƒrÄƒturi</h3>
      <div id="cartItems"></div>
      <div class="cart-summary">
        <div class="line"><span>Subtotal</span><span id="subtotal">0 lei</span></div>
        <div class="line"><span>TVA</span><span>Inclus Ã®n preÈ›</span></div>
        <div class="line total"><span>Total de platÄƒ</span><span id="grandTotal">0 lei</span></div>
        <p class="note">* PreÈ›urile includ TVA Â· Fiecare produs: 10 bucÄƒÈ›i pe set</p>
      </div>

      <div class="checkout-fields">
        <h4>Detalii livrare</h4>
        <label>Nume complet<br/><input id="checkoutName" type="text" placeholder="Nume È™i prenume" required/></label>
        <label>Nume firmÄƒ (opÈ›ional)<br/><input id="checkoutCompany" type="text" placeholder="Numele firmei (dacÄƒ existÄƒ)"/></label>
        <label>Telefon<br/><input id="checkoutPhone" type="tel" placeholder="07xxxxxxxx" required/></label>
        <label>AdresÄƒ<br/><input id="checkoutAddress" type="text" placeholder="Str., nr., oraÈ™" required/></label>
      </div>

      <div class="actions">
        <a id="whatsappBtn" class="btn whats" target="_blank" rel="noopener">ComandÄƒ pe WhatsApp</a>
        <button id="emailBtn" class="btn">Trimite comanda pe email</button>
        <div id="emailStatus" class="status"></div>
      </div>
    </section>
  </div>
  
</div>

<footer style="padding:40px 16px;text-align:center;color:var(--muted)">
  <small>Â© 2025 First Step Bebe Â· Previzualizare responsive</small>
</footer>

<!-- Lightbox overlay -->
<div id="lightbox" class="lightbox" aria-modal="true" role="dialog">
  <button id="lbPrev" class="lbBtn lbPrev" aria-label="Imaginea anterioarÄƒ">â€¹</button>
  <img id="lightboxImg" alt="Previzualizare produs" />
  <button id="lbNext" class="lbBtn lbNext" aria-label="Imaginea urmÄƒtoare">â€º</button>
</div>

<script>
const CFG = (window.APP_CONFIG||{});
// Config Supabase (completeazÄƒ cu datele tale sau lasÄƒ gol pentru fallback)
const SUPABASE_URL = CFG.SUPABASE_URL || '';
const SUPABASE_ANON_KEY = CFG.SUPABASE_ANON_KEY || '';

// ===== Date demo (cu categorii) =====
const WHATSAPP_NUMBER = "40731564284"; // fara +
const PRODUCTS_SEED = [
  {id:1,name:"Body bumbac alb",category:"body",sizes:["0-3","3-6","6-9"],colors:["alb"],price:45,pack:"10 bucÄƒÈ›i pe set",image:"assets/body1.jpg"},
  {id:2,name:"CostumaÈ™ ursuleÈ›",category:"costumas",sizes:["0-3","3-6"],colors:["roz","bleu"],price:79,pack:"10 bucÄƒÈ›i pe set",image:"assets/body1.jpg"},
  {id:3,name:"Compleu pastel 2 piese",category:"compleu",sizes:["3-6","6-9"],colors:["crem"],price:99,pack:"10 bucÄƒÈ›i pe set",image:"assets/body1.jpg"},
  {id:4,name:"Pijamale noriÈ™ori",category:"pijama",sizes:["6-9","9-12"],colors:["bleu"],price:59,pack:"10 bucÄƒÈ›i pe set",image:"assets/body1.jpg"},
  {id:5,name:"CÄƒciuliÈ›Äƒ tricot",category:"accesorii",sizes:["universal"],colors:["alb"],price:25,pack:"10 bucÄƒÈ›i pe set",image:"assets/body1.jpg"}
];

const LS_PRODUCTS='fsb_products', LS_CART='fsb_cart';
let PRODUCTS = [];
let cart = JSON.parse(localStorage.getItem(LS_CART) || '[]');

const $ = q => document.querySelector(q);
const money = x => (Math.round(x*100)/100).toFixed(2).replace('.00','') + ' lei';

// ===== Sidebar (categorii) =====
let selectedCategory = 'toate';
function listFiltered(){ return selectedCategory==='toate' ? PRODUCTS : PRODUCTS.filter(p => (p.category||'').toLowerCase()===selectedCategory); }
function wireSidebar(){
  const bar = $('#sidebar'); if(!bar) return;
  bar.addEventListener('click', (e)=>{
    const b = e.target.closest('.catbtn'); if(!b) return;
    selectedCategory = b.dataset.cat;
    [...bar.querySelectorAll('.catbtn')].forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    renderProducts();
    if(window.innerWidth<=900){ bar.classList.remove('open'); }
  });
  const tgl = $('#toggleCats'); if(tgl) tgl.onclick = ()=> $('#sidebar').classList.toggle('open');
}

// ===== Products grid =====
function renderProducts(){
  const root = $('#products'); root.innerHTML='';
  // pÄƒstrÄƒm ordinea imaginilor pentru lightbox
  window.__LB_IMAGES = listFiltered().map(p=> p.image || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==');
  listFiltered().forEach(p=>{
    const el = document.createElement('article'); el.className='card';
    const placeholder='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
    const imgSrc = p.image || placeholder;
    el.innerHTML = `
      <img src="${imgSrc}" loading="lazy" alt="${p.name}" class="zoomable"/>
      <div class="content">
        <span class="badge">${p.pack}</span>
        <h3 class="title">${p.name}</h3>
        <div class="meta">Categorie: ${(p.category||'').charAt(0).toUpperCase() + (p.category||'').slice(1)}</div>
        <div class="meta">MÄƒrimi: ${p.sizes.join(', ')}</div>
        <div class="meta">Culori: ${p.colors.join(', ')}</div>
        <div class="price">${money(p.price)} (TVA inclus)</div>
        <button class="btn" data-id="${p.id}">AdaugÄƒ Ã®n coÈ™</button>
      </div>`;
    root.appendChild(el);
  });
  root.onclick = (e)=>{
    const btn = e.target.closest('button.btn'); if(!btn) return;
    const id = +btn.dataset.id;
    const p = PRODUCTS.find(x=>x.id===id); if(p) addToCart(p);
    // feedback animat pe buton
    btn.classList.add('added');
    setTimeout(()=>btn.classList.remove('added'), 600);
  };
  // zoom pe imagine
  root.querySelectorAll('img.zoomable').forEach(img=>{
    img.style.cursor = 'zoom-in';
    img.addEventListener('click', ()=> openLightboxBySrc(img.getAttribute('src')));
  });
}

// ===== Cart =====
function addToCart(p){
  const row = cart.find(x=>x.id===p.id);
  if(row) row.qty += 1; else cart.push({id:p.id,name:p.name,price:p.price,image:p.image,qty:1});
  localStorage.setItem(LS_CART, JSON.stringify(cart));
  updateCartCount(); renderCart();
}
function updateCartCount(){ $('#cartCount').textContent = cart.reduce((s,x)=>s+x.qty,0); }
function renderCart(){
  const list = $('#cartItems'); list.innerHTML='';
  if(cart.length===0){ return; }
  cart.forEach((item,idx)=>{
    const row = document.createElement('div'); row.className='cart-item';
    const placeholder='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
    row.innerHTML = `
      <img src="${item.image || placeholder}" loading="lazy" alt="${item.name}"/>
      <div class="grow">
        <div><strong>${item.name}</strong></div>
        <div class="meta">10 bucÄƒÈ›i pe set Â· TVA inclus</div>
        <div class="qty">
          <button class="iconbtn" data-act="dec" data-idx="${idx}">âˆ’</button>
          <span>${item.qty}</span>
          <button class="iconbtn" data-act="inc" data-idx="${idx}">+</button>
        </div>
      </div>
      <div>${money(item.price*item.qty)}</div>
      <button class="iconbtn" data-act="del" data-idx="${idx}">x</button>`;
    list.appendChild(row);
  });
  list.onclick = (e)=>{
    const b=e.target.closest('.iconbtn'); if(!b) return;
    const i=+b.dataset.idx; const act=b.dataset.act;
    if(act==='inc') cart[i].qty+=1;
    if(act==='dec') cart[i].qty=Math.max(1,cart[i].qty-1);
    if(act==='del') cart.splice(i,1);
    localStorage.setItem(LS_CART, JSON.stringify(cart)); updateCartCount(); renderCart();
  };
  const subtotal = cart.reduce((s,x)=>s+x.price*x.qty,0);
  $('#subtotal').textContent = money(subtotal);
  $('#grandTotal').textContent = money(subtotal);

  // WhatsApp
  const lines = cart.map(x=>`â€¢ ${x.name} â€” ${money(x.price)} x ${x.qty} = ${money(x.price*x.qty)}`);
  const waMsg = encodeURIComponent(`BunÄƒ! Vreau sÄƒ plasez o comandÄƒ:\n`+lines.join('\n')+`\nTotal: ${money(subtotal)}`);
  $('#whatsappBtn').setAttribute('href', `https://wa.me/40731564284?text=${waMsg}`);

  // EmailJS
  $('#emailBtn').onclick = ()=> sendOrderViaEmailJS(cart, subtotal);
}

// ===== EmailJS (cheile tale) =====
const EMAILJS_PUBLIC_KEY = (CFG.EMAILJS_PUBLIC_KEY||"");
const EMAILJS_SERVICE_ID = (CFG.EMAILJS_SERVICE_ID||"");
const EMAILJS_TEMPLATE_ID = (CFG.EMAILJS_TEMPLATE_ID||"");

// ÃŽncarcÄƒ SDK-ul doar cÃ¢nd e nevoie (viteza mai bunÄƒ)
function loadEmailJSSDK() {
  return new Promise((resolve, reject) => {
    if (window.emailjs) return resolve();
    const s = document.createElement('script');
    s.src = 'https://cdn.emailjs.com/dist/email.min.js';
    s.onload = () => { emailjs.init(EMAILJS_PUBLIC_KEY); resolve(); };
    s.onerror = reject;
    document.head.appendChild(s);
  });
}

// Trimite comanda: tabel HTML (Produs, Cant., PreÈ›, Subtotal)
async function sendOrderViaEmailJS(cart, total){
  const name    = document.getElementById('checkoutName').value.trim();
  const company = (document.getElementById('checkoutCompany')?.value || '').trim();
  const phone   = document.getElementById('checkoutPhone').value.trim();
  const address = document.getElementById('checkoutAddress').value.trim();
  const status  = document.getElementById('emailStatus');

  if(!name || !phone || !address){
    status.textContent = "CompleteazÄƒ nume, telefon È™i adresÄƒ Ã®nainte de trimitere.";
    status.style.color = "#b00020";
    return;
  }
  status.textContent = "PregÄƒtesc trimiterea...";
  status.style.color = "#666";
  await loadEmailJSSDK();

  const moneyF = x => (Math.round(x*100)/100).toFixed(2).replace('.00','') + " lei";

  const rowsHtml = cart.map(x=>`
    <tr>
      <td style="padding:8px 10px; border-bottom:1px solid #eee;">${x.name}</td>
      <td style="padding:8px 10px; text-align:center; border-bottom:1px solid #eee;">${x.qty}</td>
      <td style="padding:8px 10px; text-align:right; border-bottom:1px solid #eee;">${moneyF(x.price)}</td>
      <td style="padding:8px 10px; text-align:right; border-bottom:1px solid #eee;">${moneyF(x.price*x.qty)}</td>
    </tr>
  `).join('');
  const tableHtml = `
    <table style="border-collapse:collapse; width:100%; max-width:560px;">
      <thead>
        <tr>
          <th style="text-align:left;  padding:8px 10px; border-bottom:2px solid #ddd;">Produs</th>
          <th style="text-align:center;padding:8px 10px; border-bottom:2px solid #ddd;">Cant.</th>
          <th style="text-align:right; padding:8px 10px; border-bottom:2px solid #ddd;">PreÈ›</th>
          <th style="text-align:right; padding:8px 10px; border-bottom:2px solid #ddd;">Subtotal</th>
        </tr>
      </thead>
      <tbody>${rowsHtml}</tbody>
    </table>
  `;

  // Trimitere prin funcÈ›ia Netlify + Resend
  const to = (CFG.ORDER_EMAIL_TO||"");
  const from = (CFG.ORDER_EMAIL_FROM||"Store <onboarding@resend.dev>");
  const subject = `ComandÄƒ nouÄƒ â€” ${name}`;
  const html = `
    <div style="font-family:Arial, sans-serif; color:#222">
      <h3>ComandÄƒ nouÄƒ</h3>
      <p><strong>Nume:</strong> ${name}<br/>
         <strong>FirmÄƒ:</strong> ${company||'-'}<br/>
         <strong>Telefon:</strong> ${phone}<br/>
         <strong>AdresÄƒ:</strong> ${address}</p>
      ${tableHtml}
      <p><strong>Total:</strong> ${moneyF(total)}</p>
    </div>`;
  try{
    const resp = await fetch('/.netlify/functions/send-order', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ to, from, subject, html })
    });
    if(!resp.ok) throw new Error(await resp.text());
    status.textContent = "Comanda a fost trimisÄƒ cu succes!"; status.style.color="#1a7f37";
  }catch(err){ status.textContent = "Eroare la trimitere. Te rugÄƒm Ã®ncearcÄƒ din nou."; status.style.color="#b00020"; }
}

// ===== Nav =====
document.getElementById('navProducts').onclick=(e)=>{e.preventDefault(); document.getElementById('cartModal').classList.remove('open'); document.getElementById('products').scrollIntoView({behavior:'smooth'});}
document.getElementById('navCart').onclick=(e)=>{e.preventDefault(); document.getElementById('cartModal').classList.add('open'); renderCart();}
document.getElementById('cartClose').onclick=(e)=>{e.preventDefault(); document.getElementById('cartModal').classList.remove('open');}
document.getElementById('cartModal').addEventListener('click',(e)=>{ if(e.target.id==='cartModal') document.getElementById('cartModal').classList.remove('open'); });
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') document.getElementById('cartModal').classList.remove('open'); });

// ===== Supabase loader
async function loadSupabase() {
  if (!SUPABASE_URL || !SUPABASE_ANON_KEY) return null;
  if (window.supabase) return window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  await new Promise((resolve, reject) => {
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
    s.onload = resolve; s.onerror = reject; document.head.appendChild(s);
  });
  return window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
}

async function initProducts() {
  try {
    const client = await loadSupabase();
    if (client) {
      const { data, error } = await client.from('products').select('*').order('created_at', { ascending: false });
      if (error) throw error;
      PRODUCTS = (data || []).map((p,i)=>({
        id: p.id || (i+1),
        name: p.name || '',
        category: (p.category||'').toLowerCase(),
        sizes: p.sizes || [],
        colors: p.colors || [],
        price: Number(p.price)||0,
        pack: p.pack || '10 bucÄƒÈ›i pe set',
        image: p.image_url || '',
      }));
    } else {
      // ÃŽncarcÄƒ din JSON (Netlify CMS)
      try{
        const res = await fetch('data/products.json', { cache: 'no-cache' });
        const json = await res.json();
        PRODUCTS = (json && Array.isArray(json.products)) ? json.products : PRODUCTS_SEED;
      }catch(_){
        PRODUCTS = JSON.parse(localStorage.getItem(LS_PRODUCTS) || 'null') || PRODUCTS_SEED;
        localStorage.setItem(LS_PRODUCTS, JSON.stringify(PRODUCTS));
      }
    }
  } catch (e) {
    PRODUCTS = JSON.parse(localStorage.getItem(LS_PRODUCTS) || 'null') || PRODUCTS_SEED;
    localStorage.setItem(LS_PRODUCTS, JSON.stringify(PRODUCTS));
  }
}

// Init
(async function(){
  await initProducts();
  wireSidebar(); renderProducts(); updateCartCount();
})();

// Lightbox logic
let __lbIndex = 0;
function openLightboxBySrc(src){
  const arr = (window.__LB_IMAGES||[]);
  const idx = arr.indexOf(src);
  openLightbox(idx>=0?idx:0);
}
function openLightbox(index){
  const arr = (window.__LB_IMAGES||[]);
  if(arr.length===0) return;
  __lbIndex = (index+arr.length)%arr.length;
  const im = document.getElementById('lightboxImg'); im.src = arr[__lbIndex];
  document.getElementById('lightbox').classList.add('open');
}
function closeLightbox(){ document.getElementById('lightbox').classList.remove('open'); }
document.getElementById('lightbox').addEventListener('click', (e)=>{
  if(e.target.id==='lightbox' || e.target.id==='lightboxImg') closeLightbox();
});
document.addEventListener('keydown', (e)=>{
  if(e.key==='Escape') closeLightbox();
  if(document.getElementById('lightbox').classList.contains('open')){
    if(e.key==='ArrowRight') nextImage();
    if(e.key==='ArrowLeft') prevImage();
  }
});
function nextImage(){ openLightbox(__lbIndex+1); }
function prevImage(){ openLightbox(__lbIndex-1); }
document.getElementById('lbNext').addEventListener('click', (e)=>{ e.stopPropagation(); nextImage(); });
document.getElementById('lbPrev').addEventListener('click', (e)=>{ e.stopPropagation(); prevImage(); });

// Pinch-to-zoom & pan pe mobil
const lbImg = document.getElementById('lightboxImg');
let lbScale = 1, lbStartDist = 0, lbBaseScale = 1;
let lbPanX = 0, lbPanY = 0, lbStartPanX = 0, lbStartPanY = 0;
let lbLastTouchTime = 0;

function applyTransform(){
  lbImg.style.transform = `translate(${lbPanX}px, ${lbPanY}px) scale(${lbScale})`;
}
function resetTransform(){ lbScale=1; lbPanX=0; lbPanY=0; lbBaseScale=1; lbStartDist=0; applyTransform(); }

function getDistance(t1,t2){ const dx=t1.clientX - t2.clientX, dy=t1.clientY - t2.clientY; return Math.hypot(dx,dy); }
function getCenter(t1,t2){ return { x:(t1.clientX+t2.clientX)/2, y:(t1.clientY+t2.clientY)/2 }; }

lbImg.addEventListener('touchstart', (e)=>{
  if(e.touches.length===2){
    e.preventDefault();
    lbStartDist = getDistance(e.touches[0], e.touches[1]);
    lbBaseScale = lbScale;
  } else if(e.touches.length===1 && lbScale>1){
    e.preventDefault();
    lbStartPanX = e.touches[0].clientX - lbPanX;
    lbStartPanY = e.touches[0].clientY - lbPanY;
  }
}, { passive:false });

lbImg.addEventListener('touchmove', (e)=>{
  if(e.touches.length===2){
    e.preventDefault();
    const dist = getDistance(e.touches[0], e.touches[1]);
    const scale = Math.min(4, Math.max(1, lbBaseScale * (dist / (lbStartDist||dist))));
    lbScale = scale; applyTransform();
  } else if(e.touches.length===1 && lbScale>1){
    e.preventDefault();
    lbPanX = e.touches[0].clientX - lbStartPanX;
    lbPanY = e.touches[0].clientY - lbStartPanY;
    applyTransform();
  }
}, { passive:false });

lbImg.addEventListener('touchend', (e)=>{
  // double-tap pentru toggle zoom
  const now = Date.now();
  if(e.touches.length===0 && (now - lbLastTouchTime)<250){
    lbScale = (lbScale>1?1:2); lbPanX=0; lbPanY=0; applyTransform();
  }
  lbLastTouchTime = now;
});

// Reset transform la schimbarea imaginii / Ã®nchidere
const _openLightboxRef = openLightbox;
openLightbox = (index)=>{ resetTransform(); _openLightboxRef(index); };
const _closeRef = closeLightbox;
closeLightbox = ()=>{ _closeRef(); resetTransform(); };
</script>
</body>
</html>
